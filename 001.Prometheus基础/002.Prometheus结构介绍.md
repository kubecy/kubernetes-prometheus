# Prometheus结构介绍

## 1. Prometheus 介绍

:mag:https://prometheus.io

1. Prometheus是基于go语⾔开发的⼀套开源的监控、报警和时间序列数据库的组合，是由SoundCloud公司开发的开源监控系统，Prometheus于2016年加⼊CNCF（Cloud Native Computing Foundation,云原⽣计算基⾦会）,2018年8⽉9⽇prometheus成为CNCF继kubernetes 之后毕业的第⼆个项⽬，prometheus在容器和微服务领域中得到了⼴泛的应用。
2. 使⽤key-value的多维度(多个⻆度，多个层⾯，多个⽅⾯)格式保存数据 ，数据不使⽤MySQL这样的传统数据库，⽽是使⽤时序数据库，⽬前是使⽤的TSDB ⽀持第三⽅dashboard实现更绚丽的图形界⾯，如grafana(Grafana 2.5.0版本及以上) ，组件模块化 ，不需要依赖存储，数据可以本地保存也可以远程保存，平均每个采样点仅占3.5 bytes，且⼀个Prometheus server可以处理数百万级别的的metrics指标数 据。 ⽀持服务⾃动化发现(基于consul等⽅式动态发现被监控的⽬标服务) 强⼤的数据查询语句(PromQL,Prometheus Query Language) ，数据可以直接进⾏算术运算 ，易于横向伸缩 ，众多官⽅和第三⽅的exporter实现不同的指标数据收集。
3. 容器监控的实现⽅对⽐虚拟机或者物理机来说⽐⼤的区别，⽐如容器在k8s环境中可以任意横向扩容与缩容，那么就需要监控服务能够⾃动对新创建的容器进⾏监控，当容器删除后⼜能够及时的从监控服务中删除，⽽传统的zabbix的监控⽅式需要在每⼀个容器中安装启动agent，并且在容器⾃动发现注册及模板关联⽅⾯并没有⽐较好的实现⽅式。
4. Prometheus支持通过三种类型的途径从目标上抓取（Scrape）指标数据。
   - Exporters 
   - Instrumentation 
   - Pushgateway

![image-20240820235315912](./000.picture/image-20240820235315912.png)

## 2. Prometheus 生态组件

- Prometheus 生态圈中包含了多个组件，其中部分组件可选：
  1. Prometheus Server: 收集和存储时间序列数据。
  2. Client Library: 客户端库，目的在于为那些期望原生提供Instrumentation功能的应用程序提供便捷的开发途径。
  3. Push Gateway: 接收那些通常由短期作业生成的指标数据的网关，并支持由Prometheus Server进行指标拉取操作。
  4. Exporters: 用于暴露现有应用程序或服务（不支持Instrumentation）的指标给Prometheus Server。
  5. Alertmanager: 从Prometheus Server接收到“告警通知”后，通过去重、分组、路由等预处理功能后以高效向用户完成告警信息发送。
  6. Data Visualization：Prometheus Web UI （Prometheus Server内建），及Grafana等。
  7. Service Discovery：动态发现待监控的Target，从而完成监控配置的重要组件，在容器化环境中尤为有用；该组件目前由Prometheus Server内建支持。

## 3. Prometheus 数据模型

> Prometheus仅用于以“键值”形式存储时序式的聚合数据，它并不支持存储文本信息

1. 其中的==键==称为指标（Metric)，它通常意味着CPU速率、内存使用率或分区空闲比例等。
2. 同一指标可能会适配到多个目标或设备，因而它使用标签作为元数据，从而为Metric添加更多的信息描述纬度。
3. 这些标签还可以作为过滤器进行指标过滤及聚合运算。

